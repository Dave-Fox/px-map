{"version":3,"sources":["px-map-behavior-layer.es6.js"],"names":["MapLayerBase","attached","__elAttached","notifyInstReady","canAddInst","detached","shouldRemoveInst","addInst","parent","addLayer","elementInst","removeInst","remove","isReady","fire","MapLayerParentBase","listeners","created","_attachedChildren","WeakMap","_detachLayerChildren","_tryToAddAllChildren","evt","srcElement","_attachLayerChildren","_tryToAddOneChild","stopPropagation","_attachLayerChild","children","getEffectiveChildren","length","child","childEl","has","shouldAddInst","set","async","_detachLayerChild","delete","namespace","window","PxMapBehavior","MapLayer","MapElement","MapLayerParent"],"mappings":"aAAA,CAAC,UAAW,CACV,aAOA,GAAMA,cAAe,CAInBC,QAJmB,oBAIR,CACT,KAAKC,YAAL,CAAoB,IAApB,CACA,KAAKC,eAAL,CAAqB,KAAKC,UAAL,EAArB,CACD,CAPkB,CAYnBC,QAZmB,oBAYR,CACT,KAAKH,YAAL,CAAoB,KAApB,CACA,KAAKI,gBAAL,EACD,CAfkB,CAmBnBC,OAnBmB,kBAmBXC,MAnBW,CAmBH,CACdA,OAAOC,QAAP,CAAgB,KAAKC,WAArB,CACD,CArBkB,CAuBnBC,UAvBmB,qBAuBRH,MAvBQ,CAuBA,CACjB,KAAKE,WAAL,CAAiBE,MAAjB,EACD,CAzBkB,CA2CnBR,UA3CmB,sBA2CN,CACX,MAAO,KACR,CA7CkB,CAsDnBD,eAtDmB,2BAsDW,IAAdU,QAAc,2DAAN,IAAM,CAC5B,GAAI,CAACA,OAAL,CAAc,MAAO,MAAP,CACd,KAAKC,IAAL,CAAU,2BAAV,EACA,MAAO,KACR,CA1DkB,CAArB,CAkEA,GAAMC,oBAAqB,CACzBC,UAAW,CACT,gCAAkC,sBADzB,CAET,4BAA8B,mBAFrB,CADc,CAMzBC,OANyB,mBAMf,CAER,KAAKC,iBAAL,CAAyB,KAAKA,iBAAL,EAA0B,GAAIC,QACxD,CATwB,CAWzBd,QAXyB,oBAWd,CACT,KAAKe,oBAAL,EACD,CAbwB,CAiBzBC,oBAjByB,+BAiBJC,GAjBI,CAiBC,CAGxB,GAAI,CAAC,KAAKZ,WAAN,EAAqBY,IAAIC,UAAJ,GAAmB,IAA5C,CAAkD,OAGlD,KAAKC,oBAAL,EACD,CAxBwB,CA0BzBC,iBA1ByB,4BA0BPH,GA1BO,CA0BF,CAErB,GAAIA,IAAIC,UAAJ,GAAmB,IAAvB,CAA6B,OAG7BD,IAAII,eAAJ,GAGA,GAAI,CAAC,KAAKhB,WAAV,CAAuB,OAEvB,KAAKiB,iBAAL,CAAuBL,IAAIC,UAA3B,CACD,CArCwB,CAuCzBC,oBAvCyB,gCAuCF,CACrB,GAAMI,UAAW,KAAKC,oBAAL,EAAjB,CACA,GAAI,CAACD,QAAD,EAAa,CAACA,SAASE,MAA3B,CAAmC,OAFd,gGAIrB,kBAAkBF,QAAlB,oHAA4B,IAAnBG,MAAmB,aAC1B,KAAKJ,iBAAL,CAAuBI,KAAvB,CACD,CANoB,4LAOtB,CA9CwB,CAgDzBJ,iBAhDyB,4BAgDPK,OAhDO,CAgDE,gBACzB,GAAI,KAAKd,iBAAL,CAAuBe,GAAvB,CAA2BD,OAA3B,GAAuC,CAACA,QAAQE,aAAhD,EAAiE,CAACF,QAAQ5B,UAA1E,EAAwF,CAAC4B,QAAQ5B,UAAR,EAA7F,CAAmH,OACnH,KAAKc,iBAAL,CAAuBiB,GAAvB,CAA2BH,OAA3B,CAAoC,IAApC,EAEA,KAAKI,KAAL,CAAW,UAAM,CAAEJ,QAAQE,aAAR,CAAsB,MAAKxB,WAA3B,CAA0C,CAA7D,CACD,CArDwB,CAyDzBU,oBAzDyB,gCAyDF,CACrB,GAAMQ,UAAW,KAAKC,oBAAL,EAAjB,CACA,GAAI,CAACD,QAAD,EAAa,CAACA,SAASE,MAA3B,CAAmC,OAFd,mGAIrB,mBAAkBF,QAAlB,yHAA4B,IAAnBG,MAAmB,cAC1B,KAAKM,iBAAL,CAAuBN,KAAvB,CACD,CANoB,mMAOtB,CAhEwB,CAkEzBM,iBAlEyB,4BAkEPL,OAlEO,CAkEE,iBACzB,GAAI,CAAC,KAAKd,iBAAL,CAAuBe,GAAvB,CAA2BD,OAA3B,CAAD,EAAwC,CAACA,QAAQ1B,gBAArD,CAAuE,OACvE,KAAKY,iBAAL,CAAuBoB,MAAvB,CAA8BN,OAA9B,EAEA,KAAKI,KAAL,CAAW,UAAM,CAAEJ,QAAQ1B,gBAAR,CAAyB,OAAKI,WAA9B,CAA6C,CAAhE,CACD,CAvEwB,CAA3B,CA2EA,GAAM6B,WAAaC,OAAOC,aAAP,CAAuBD,OAAOC,aAAP,EAAwB,EAAlE,CAGAF,UAAUvC,YAAV,CAAyBA,YAAzB,CACAuC,UAAUG,QAAV,CAAqB,CACnBH,UAAUI,UADS,CAEnBJ,UAAUvC,YAFS,CAArB,CAMAuC,UAAUxB,kBAAV,CAA+BA,kBAA/B,CACAwB,UAAUK,cAAV,CAA2B,CACzBL,UAAUG,QADe,CAEzBH,UAAUxB,kBAFe,CAK5B,CArKD","file":"px-map-behavior-layer.js","sourcesContent":["(function() {\n  'use strict';\n\n  /**\n   *\n   *\n   * @polymerBehavior PxMapBehavior.MapLayerBase\n   */\n  const MapLayerBase = {\n    // When this element is attached to the DOM, fire an event to notify\n    // a parent that it is ready\n\n    attached() {\n      this.__elAttached = true;\n      this.notifyInstReady(this.canAddInst());\n    },\n\n    // When this element is detached from the DOM, its elementInst should be\n    // removed from the parent\n\n    detached() {\n      this.__elAttached = false;\n      this.shouldRemoveInst();\n    },\n\n    // Methods to bind to/unbind from parent\n\n    addInst(parent) {\n      parent.addLayer(this.elementInst);\n    },\n\n    removeInst(parent) {\n      this.elementInst.remove();\n    },\n\n    /**\n     * Some element instances may require a minimum number of defined options\n     * to be able to attach to their parent. If those options are defined via.\n     * attributes, they may not be deserialized or even set before the `willAddInst`\n     * method is called.\n     *\n     * Elements that need to defer until some options are set should override\n     * the `canAddInst` method and return `false` if the method\n     *\n     * Elements that may need to defer until some options are ready should\n     * override `instReady` and set it to `false` by default.\n     *\n     * Later, when the `updateInst` function is called, the element should check\n     * if all required options are set and call the method `this.notifyInstReady(true)`\n     * to trigger an event the parent will catch and use to attach this element.\n     */\n    canAddInst() {\n      return true;\n    },\n\n    /**\n     * If this element's instance is ready to create and add to its parent,\n     * fires an event the parent will catch.\n     *\n     * @param {Boolean} isReady - If `true` instance parent will be notified\n     * @return {Boolean} - If `true` the parent was notified\n     */\n    notifyInstReady(isReady=true) {\n      if (!isReady) return false;\n      this.fire('px-map-layer-ready-to-add');\n      return true;\n    }\n  };\n\n  /**\n   *\n   *\n   * @polymerBehavior PxMapBehavior.MapLayerParentBase\n   */\n  const MapLayerParentBase = {\n    listeners: {\n      'px-map-layer-instance-created' : '_tryToAddAllChildren',\n      'px-map-layer-ready-to-add' : '_tryToAddOneChild'\n    },\n\n    created() {\n      // Use a WeakMap to keep track of our attached children\n      this._attachedChildren = this._attachedChildren || new WeakMap();\n    },\n\n    detached() {\n      this._detachLayerChildren();\n    },\n\n    // Handles attaching children throughout this element's lifecycle\n\n    _tryToAddAllChildren(evt) {\n      // If this element's elementInst isn't ready, halt and wait until later\n      // If this event isn't coming from this element, do not handle\n      if (!this.elementInst || evt.srcElement !== this) return;\n\n      // If my own elementInst was just created, loop over children and try to attach them\n      this._attachLayerChildren();\n    },\n\n    _tryToAddOneChild(evt) {\n      // If the added-to-dom event belongs to this element, just return and let it bubble\n      if (evt.srcElement === this) return;\n\n      // This element is the parent, so stop this event from bubbling\n      evt.stopPropagation();\n\n      // If I have no elementInst, halt and wait until later\n      if (!this.elementInst) return;\n\n      this._attachLayerChild(evt.srcElement);\n    },\n\n    _attachLayerChildren() {\n      const children = this.getEffectiveChildren();\n      if (!children || !children.length) return;\n\n      for (let child of children) {\n        this._attachLayerChild(child);\n      }\n    },\n\n    _attachLayerChild(childEl) {\n      if (this._attachedChildren.has(childEl) || !childEl.shouldAddInst || !childEl.canAddInst || !childEl.canAddInst()) return;\n      this._attachedChildren.set(childEl, true);\n\n      this.async(() => { childEl.shouldAddInst(this.elementInst); });\n    },\n\n    // Handles detaching children throughout this element's lifecycle\n\n    _detachLayerChildren() {\n      const children = this.getEffectiveChildren();\n      if (!children || !children.length) return;\n\n      for (let child of children) {\n        this._detachLayerChild(child);\n      }\n    },\n\n    _detachLayerChild(childEl) {\n      if (!this._attachedChildren.has(childEl) || !childEl.shouldRemoveInst) return;\n      this._attachedChildren.delete(childEl);\n\n      this.async(() => { childEl.shouldRemoveInst(this.elementInst); });\n    }\n  };\n\n  /* Ensures the behavior namespace is created */\n  const namespace = (window.PxMapBehavior = window.PxMapBehavior || {});\n\n  /* Bind MapLayer base and chained behaviors */\n  namespace.MapLayerBase = MapLayerBase;\n  namespace.MapLayer = [\n    namespace.MapElement,\n    namespace.MapLayerBase\n  ];\n\n  /* Bind MapLayerParent base and chained behaviors */\n  namespace.MapLayerParentBase = MapLayerParentBase;\n  namespace.MapLayerParent = [\n    namespace.MapLayer,\n    namespace.MapLayerParentBase\n  ];\n\n})()\n"]}