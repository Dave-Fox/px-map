'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}(function(){'use strict';var MapLayerLifecycleMixin=function MapLayerLifecycleMixin(superclass){return function(_superclass){_inherits(_class,_superclass);function _class(){_classCallCheck(this,_class);return _possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).apply(this,arguments))}_createClass(_class,[{key:'willAddInst',value:function willAddInst(){if(this.elementInst)return;var options=this.__initialOptions=this.getOptions();this.elementInst=this.createInst(options)}},{key:'willRemoveInst',value:function willRemoveInst(){}},{key:'addInst',value:function addInst(parent){if(!parent||parent.hasLayer(this.elementInst))return;parent.addLayer(this.elementInst)}},{key:'removeInst',value:function removeInst(){if(!this.elementInst)return;this.elementInst.remove()}},{key:'shouldUpdateInst',value:function shouldUpdateInst(){if(!this.elementInst&&this.__elAttached&&this.canAddInst()){this.notifyInstReady(this.canAddInst())}if(!this.elementInst)return;var lastOptions=this.__lastOptions||this.__initialOptions;var nextOptions=this.getOptions();this.updateInst(lastOptions,nextOptions);this.__lastOptions=nextOptions}},{key:'createInst',value:function createInst(){throw new Error('The `createInst` method must be implemented.')}},{key:'updateInst',value:function updateInst(){throw new Error('The `updateInst` method must be implemented.')}},{key:'getOptions',value:function getOptions(){throw new Error('The `getOptions` method must be implemented.')}}]);return _class}(superclass)};var MapLayerChildMixin=function MapLayerChildMixin(superclass){return function(_superclass2){_inherits(_class2,_superclass2);function _class2(){_classCallCheck(this,_class2);return _possibleConstructorReturn(this,(_class2.__proto__||Object.getPrototypeOf(_class2)).apply(this,arguments))}_createClass(_class2,[{key:'created',value:function created(){this.__elAttached=false}},{key:'attached',value:function attached(){this.__elAttached=true;this.notifyInstReady(this.canAddInst())}},{key:'detached',value:function detached(){this.willRemoveInst();this.removeInst();this.__elAttached=false}},{key:'canAddInst',value:function canAddInst(){return true}},{key:'notifyInstReady',value:function notifyInstReady(isReady){if(!isReady)return false;this.fire('px-map-layer-ready-to-add');return true}}]);return _class2}(superclass)};var MapLayerParentMixin=function MapLayerParentMixin(superclass){return function(_superclass3){_inherits(_class3,_superclass3);function _class3(){_classCallCheck(this,_class3);return _possibleConstructorReturn(this,(_class3.__proto__||Object.getPrototypeOf(_class3)).apply(this,arguments))}_createClass(_class3,[{key:'created',value:function created(){this._attachedChildren=this._attachedChildren||new WeakMap}},{key:'attached',value:function attached(){this.listen(this,'px-map-layer-instance-created',this._tryToAddAllChildren.bind(this));this.listen(this,'px-map-layer-ready-to-add',this._tryToAddOneChild.bind(this))}},{key:'detached',value:function detached(){this._detachLayerChildren()}},{key:'_tryToAddAllChildren',value:function _tryToAddAllChildren(evt){if(!this.elementInst||evt.srcElement!==this)return;this._attachLayerChildren()}},{key:'_tryToAddOneChild',value:function _tryToAddOneChild(evt){if(evt.srcElement===this)return;evt.stopPropagation();if(!this.elementInst)return;this._attachLayerChild(evt.srcElement)}},{key:'_attachLayerChildren',value:function _attachLayerChildren(){var children=this.getEffectiveChildren();if(!children||!children.length)return;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;this._attachLayerChild(child)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:'_attachLayerChild',value:function _attachLayerChild(childEl){var _this4=this;if(this._attachedChildren.has(childEl)||!childEl.willAddInst||!childEl.addInst||!childEl.canAddInst||!childEl.canAddInst())return;this._attachedChildren.set(childEl,true);this.async(function(){childEl.willAddInst()});this.async(function(){childEl.addInst(_this4.elementInst)})}},{key:'_detachLayerChildren',value:function _detachLayerChildren(){var children=this.getEffectiveChildren();if(!children||!children.length)return;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var child=_step2.value;this._detachLayerChild(child)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:'_detachLayerChild',value:function _detachLayerChild(childEl){var _this5=this;if(!this._attachedChildren.has(childEl)||!childEl.willRemoveInst||!childEl.removeInst)return;this._attachedChildren.delete(childEl);this.async(function(){childEl.willRemoveInst()});this.async(function(){childEl.removeInst(_this5.elementInst)})}}]);return _class3}(superclass)};var mixins=window.PxMapMixin=window.PxMapMixin||{};mixins.MapLayerLifecycle=MapLayerLifecycleMixin;mixins.MapLayerChild=MapLayerChildMixin;mixins.MapLayerParent=MapLayerParentMixinMixin;var MapLayer=function(_mixwith$mix$with){_inherits(MapLayer,_mixwith$mix$with);function MapLayer(){_classCallCheck(this,MapLayer);var _this6=_possibleConstructorReturn(this,(MapLayer.__proto__||Object.getPrototypeOf(MapLayer)).apply(this,arguments));_this6.initialize();return _this6}return MapLayer}(mixwith.mix().with(PxMapMixin.MapElement,PxMapMixin.MapLayerLifecycle,PxMapMixin.MapLayerChild,PxMapMixin.MapLayerParent))})();
//# sourceMappingURL=px-map-mixin-layer.js.map
