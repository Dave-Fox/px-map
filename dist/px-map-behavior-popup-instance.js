'use strict';var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}(function(){'use strict';var PopupInstance={properties:_defineProperty({active:{type:Boolean,value:false,readOnly:true},parentInstance:{type:Object,notify:true},bindToControl:{type:String}},'active',{type:Boolean,value:false,readOnly:true}),observers:['_attachToParentInstance(parentInstance)'],ready:function ready(){var instance=this._createElementInstance();this._setElementInstance(instance)},attached:function attached(){this._attachToParentInstance()},detached:function detached(){this._detachFromParentInstance()},_createElementInstance:function _createElementInstance(){var popup=this._createPopup();return popup},_createPopup:function _createPopup(){return L.popup()},_updatePopupContent:function _updatePopupContent(){if(this.elementInstance&&this.active){var newContent=this._getPopupContent();var existingContent=this.elementInstance.getContent();if(newContent!==existingContent){this.elementInstance.setContent(newContent);this.fire('px-map-popup-content-changed',{popup:this.elementInstance,content:newContent})}}},_attachToParentInstance:function _attachToParentInstance(){if(!this.parentInstance)return;this._bindPopupInstanceEvents();if(this.bindToControl&&this.bindToControl.length){return}if(this.parentInstance.getPopup()!==this.elementInstance){this.parentInstance.bindPopup(this.elementInstance)}},_detachFromParentInstance:function _detachFromParentInstance(){if(!this.parentInstance)return;this._unbindPopupInstanceEvents();if(this.parentInstance.getPopup()===this.elementInstance){this.parentInstance.removeLayer(this.elementInstance)}},_bindPopupInstanceEvents:function _bindPopupInstanceEvents(){if(!this.parentInstance)return;this._boundPopupEvents=this._boundPopupEvents||{};if(!this._boundPopupEvents.popupopen&&typeof this._handlePopupOpen==='function'){this._boundPopupEvents.popupopen=this._handlePopupOpen.bind(this)}if(!this._boundPopupEvents.popupclose&&typeof this._handlePopupClose==='function'){this._boundPopupEvents.popupclose=this._handlePopupClose.bind(this)}if(!this._boundPopupEvents.click&&this.bindToControl&&this.bindToControl.length){this._boundPopupEvents.click=this._handlePopupParentClick.bind(this)}this.parentInstance.on(this._boundPopupEvents)},_unbindPopupInstanceEvents:function _unbindPopupInstanceEvents(){if(!this.parentInstance)return;if(_typeof(this._boundPopupEvents)==='object'){this.parentInstance.off(this._boundPopupEvents)}},_handlePopupParentClick:function _handlePopupParentClick(evt){if(this.bindToControl&&this.bindToControl.length){this._map=evt.target._map;this._boundPopupMapEvents={click:this._handlePopupMapClick.bind(this)};this._map.on(this._boundPopupMapEvents);evt.target.fire('popupopen',{popup:this.elementInstance},true);this.fire('px-map-info-control-bind',{content:this.elementInstance.getContent(),control:this.bindToControl,popup:this});L.DomEvent.stop(evt)}},_handlePopupMapClick:function _handlePopupMapClick(evt){if(this.bindToControl&&this.bindToControl.length){this.fire('px-map-info-control-unbind',{control:this.bindToControl,source:this})}this.parentElement.fire('popupclose',{popup:this});this._map.off(this._boundPopupMapEvents)},_handlePopupOpen:function _handlePopupOpen(){this._setActive(true);this._updatePopupContent()},_handlePopupClose:function _handlePopupClose(){this._setActive(false)}};var namespace=window.PxMapBehavior=window.PxMapBehavior||{};namespace.PopupInstance=PopupInstance})();
//# sourceMappingURL=px-map-behavior-popup-instance.js.map
